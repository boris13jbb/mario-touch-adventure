name: Build APK - Mario Touch Adventure

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.24.5'
        channel: 'stable'
    
    - name: Install dependencies
      run: flutter pub get
    
    - name: Analyze project source
      run: flutter analyze
    
    - name: Run tests
      run: flutter test
    
    - name: Build APK
      run: flutter build apk --release
    
    - name: Upload APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: mario-touch-adventure-apk
        path: build/app/outputs/flutter-apk/app-release.apk
        retention-days: 30
    
    - name: Create Release
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: softprops/action-gh-release@v1
      with:
        files: build/app/outputs/flutter-apk/app-release.apk
        tag_name: v${{ github.run_number }}
        name: Mario Touch Adventure v${{ github.run_number }}
        body: |
          ğŸ® **Mario Touch Adventure - VersiÃ³n Mejorada**
          
          ### âœ¨ **Nuevas CaracterÃ­sticas:**
          
          #### ğŸ¯ **MecÃ¡nicas Profesionales**
          - **FÃ­sica Realista**: Gravedad, saltos y colisiones realistas
          - **Movimiento Fluido**: AceleraciÃ³n y fricciÃ³n naturales
          - **Combate Avanzado**: Sistema de proyectiles con trayectorias
          - **Enemigos Inteligentes**: IA con patrones de movimiento
          
          #### ğŸ¨ **UI/UX Profesional**
          - **Animaciones Suaves**: Transiciones y micro-interacciones
          - **DiseÃ±o Responsivo**: Optimizado para todas las pantallas
          - **RetroalimentaciÃ³n HÃ¡ptica**: Respuestas tÃ¡ctiles
          - **Efectos Visuales**: PartÃ­culas y sacudida de pantalla
          
          #### ğŸ”Š **Audio Inmersivo**
          - **MÃºsica DinÃ¡mica**: Banda sonora adaptativa
          - **Efectos Profesionales**: Sonidos para todos los eventos
          - **Controles de Volumen**: Ajustes independientes
          - **Persistencia**: Configuraciones guardadas
          
          #### ğŸ’¾ **Sistema Avanzado**
          - **Guardado Completo**: Progreso persistente
          - **Logros Desbloqueables**: Sistema de logros
          - **EstadÃ­sticas Detalladas**: AnÃ¡lisis de gameplay
          - **Configuraciones Personalizables**: Preferencias del usuario
          
          ### ğŸ® **Controles del Juego**
          
          #### Controles TÃ¡ctiles:
          - **â¬…ï¸ â¡ï¸ Movimiento**: Botones izquierda/derecha
          - **â¬†ï¸ Salto**: BotÃ³n de salto
          - **âš”ï¸ Ataque**: BotÃ³n de ataque
          - **â¸ï¸ Pausa**: BotÃ³n de pausa en HUD
          
          ### ğŸ† **Logros Disponibles**
          
          - **Primeros Pasos**: Completar el primer nivel
          - **Colector de Monedas**: Recolectar 100 monedas
          - **Cazador de Enemigos**: Derrotar 50 enemigos
          - **Corredor Veloz**: Completar 5 niveles en menos de 10 minutos
          - **Jugador Perfecto**: Completar un nivel sin perder vidas
          - **Maestro del Juego**: Llegar al nivel 10
          
          ### ğŸ“Š **EstadÃ­sticas del Juego**
          
          El juego rastrea:
          - **Tiempo Total de Juego**: DuraciÃ³n acumulativa
          - **Monedas Recolectadas**: Total de monedas
          - **Enemigos Derrotados**: NÃºmero de enemigos eliminados
          - **Niveles Completados**: Progreso a travÃ©s del juego
          - **Niveles Perfectos**: Niveles completados sin perder vidas
          
          ### ğŸ”§ **Configuraciones Disponibles**
          
          #### Configuraciones del Juego:
          - **Efectos de Sonido**: Activar/desactivar sonidos individuales
          - **MÃºsica de Fondo**: Controlar reproducciÃ³n de mÃºsica
          - **VibraciÃ³n**: Activar/desactivar retroalimentaciÃ³n hÃ¡ptica
          - **Velocidad del Juego**: Ajustar velocidad (0.5x - 2.0x)
          
          #### Configuraciones de Rendimiento:
          - **Efectos de PartÃ­culas**: Activar/desactivar efectos visuales
          - **Sacudida de Pantalla**: Controlar intensidad
          - **Calidad de AnimaciÃ³n**: Ajustar suavidad
          
          ### ğŸ“± **InstalaciÃ³n en Android**
          
          #### Paso 1: Habilitar Fuentes Desconocidas
          1. Ve a **ConfiguraciÃ³n**
          2. Ve a **Seguridad**
          3. Activa **Fuentes desconocidas**
          
          #### Paso 2: Instalar APK
          1. Descarga el APK
          2. Toca en el archivo descargado
          3. Sigue las instrucciones de instalaciÃ³n
          
          #### Paso 3: Disfrutar del Juego
          1. Abre la aplicaciÃ³n
          2. Â¡Juega Mario Touch Adventure Mejorado!
          
          ### ğŸš€ **Mejoras Implementadas**
          
          âœ… **Motor de FÃ­sica Realista**
          âœ… **Sistema de Audio Profesional**  
          âœ… **UI/UX Mejorado con Animaciones**
          âœ… **Sistema de Guardado Avanzado**
          âœ… **Controles TÃ¡ctiles con Haptic Feedback**
          âœ… **Efectos Visuales y PartÃ­culas**
          âœ… **Sistema de Logros y EstadÃ­sticas**
          âœ… **Configuraciones Personalizables**
          âœ… **OptimizaciÃ³n de Rendimiento**
          âœ… **DocumentaciÃ³n Profesional**
          
          **Â¡El juego ahora es completamente profesional y realista!** ğŸš€
          
          ---
          
          **Â¡Disfruta del juego mejorado!** ğŸ®âœ¨
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
